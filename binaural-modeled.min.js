!function(t){if("object"==typeof exports&&"undefined"!=typeof module)module.exports=t();else if("function"==typeof define&&define.amd)define([],t);else{var e;e="undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:this,e.BinauralModeled=t()}}(function(){return function t(e,i,n){function s(o,a){if(!i[o]){if(!e[o]){var u="function"==typeof require&&require;if(!a&&u)return u(o,!0);if(r)return r(o,!0);var h=new Error("Cannot find module '"+o+"'");throw h.code="MODULE_NOT_FOUND",h}var l=i[o]={exports:{}};e[o][0].call(l.exports,function(t){var i=e[o][1][t];return s(i?i:t)},l,l.exports,t,e,i,n)}return i[o].exports}for(var r="function"==typeof require&&require,o=0;o<n.length;o++)s(n[o]);return s}({1:[function(t,e,i){e.exports=t("./dist/binaural-modeled")},{"./dist/binaural-modeled":2}],2:[function(t,e,i){"use strict";var n=t("babel-runtime/helpers/create-class")["default"],s=t("babel-runtime/helpers/class-call-check")["default"],r=t("babel-runtime/helpers/interop-require-default")["default"];Object.defineProperty(i,"__esModule",{value:!0});var o=t("kdt"),a=r(o),u=t("biquad-filter"),h=r(u),l=t("fractional-delay"),c=r(l),f=function(){function t(e){s(this,t),this.audioContext=e.audioContext,this.hrtfDataset=void 0,this.hrtfDatasetLength=void 0,this.nextPosition=[],this.changeWhenFinishCrossfading=!1,this.position=[],this.crossfadeDuration=.02,this.bufferSize=1024,this.tree=-1,this.input=this.audioContext.createGain(),this.mainAudioGraph=new d({audioContext:this.audioContext}),this.mainAudioGraph.gain.value=1,this.input.connect(this.mainAudioGraph.input),this.secondaryAudioGraph=new d({audioContext:this.audioContext}),this.secondaryAudioGraph.gain.value=0,this.input.connect(this.secondaryAudioGraph.input),this.sampleRate=this.audioContext.sampleRate,this.input.connect(this.mainAudioGraph.input),this.input.connect(this.secondaryAudioGraph.input)}return n(t,[{key:"connect",value:function(t){return this.mainAudioGraph.connect(t),this.secondaryAudioGraph.connect(t),this}},{key:"disconnect",value:function(t){return this.mainAudioGraph.disconnect(t),this.secondaryAudioGraph.disconnect(t),this}},{key:"distance",value:function(t,e){return Math.pow(t.x-e.x,2)+Math.pow(t.y-e.y,2)+Math.pow(t.z-e.z,2)}},{key:"setLastPosition",value:function(){this.isCrossfading()||(this.changeWhenFinishCrossfading=!1,clearInterval(this.intervalID),this.reallyStartPosition())}},{key:"crossfading",value:function(){var t=this.audioContext.currentTime;this.mainAudioGraph.gain.setValueAtTime(1,t+2*this.bufferSize/this.sampleRate),this.mainAudioGraph.gain.linearRampToValueAtTime(0,t+this.crossfadeDuration+2*this.bufferSize/this.sampleRate),this.secondaryAudioGraph.gain.setValueAtTime(0,t+2*this.bufferSize/this.sampleRate),this.secondaryAudioGraph.gain.linearRampToValueAtTime(1,t+this.crossfadeDuration+2*this.bufferSize/this.sampleRate)}},{key:"setPosition",value:function(t,e,i){if(3===arguments.length){var n=this.getRealCoordinates(t,e,i);if(n.azimuth!==this.position.azimuth||n.elevation!==this.position.elevation||n.distance!==this.position.distance)return this.isCrossfading()===!0?(this.changeWhenFinishCrossfading===!0?clearInterval(this.intervalID):this.changeWhenFinishCrossfading=!0,this.nextPosition.azimuth=n.azimuth,this.nextPosition.elevation=n.elevation,this.nextPosition.distance=n.distance,this.intervalID=window.setInterval(this.setLastPosition.bind(this),.005)):(this.nextPosition.azimuth=n.azimuth,this.nextPosition.elevation=n.elevation,this.nextPosition.distance=n.distance,this.reallyStartPosition()),this}}},{key:"reallyStartPosition",value:function(){this.position.azimuth=this.nextPosition.azimuth,this.position.elevation=this.nextPosition.elevation,this.position.distance=this.nextPosition.distance;var t=this.getHRTF(this.position.azimuth,this.position.elevation,this.position.distance);this.secondaryAudioGraph.setCoefficients(t.iir_coeffs_left,t.iir_coeffs_right),this.secondaryAudioGraph.setDelay(t.itd/1e3),this.crossfading();var e=this.mainAudioGraph;this.mainAudioGraph=this.secondaryAudioGraph,this.secondaryAudioGraph=e}},{key:"getPosition",value:function(){return this.position}},{key:"setCrossfadeDuration",value:function(t){this.crossfadeDuration=t/1e3}},{key:"getCrossfadeDuration",value:function(){return 1e3*this.crossfadeDuration}},{key:"isCrossfading",value:function(){return 1!==this.mainAudioGraph.gain.value?!0:!1}},{key:"getHRTF",value:function(t,e,i){var n=this.getNearestPoint(t,e,i),s=[];return s.iir_coeffs_left=n.iir_coeffs_left,s.iir_coeffs_right=n.iir_coeffs_right,s.itd=n.itd,s}},{key:"sphericalToCartesian",value:function(t,e,i){return{x:i*Math.sin(t),y:i*Math.cos(t),z:i*Math.sin(e)}}},{key:"getRealCoordinates",value:function(t,e,i){var n=this.getNearestPoint(t,e,i);return{azimuth:n.azimuth,elevation:n.elevation,distance:n.distance}}},{key:"getNearestPoint",value:function(t,e,i){var n=t*Math.PI/180,s=e*Math.PI/180,r=this.sphericalToCartesian(n,s,i),o=this.tree.nearest(r,1)[0];return o[0]}},{key:"HRTFDataset",set:function(t){this.hrtfDataset=t,this.hrtfDatasetLength=this.hrtfDataset.length;for(var e=0;e<this.hrtfDatasetLength;e++){var i=this.hrtfDataset[e],n=i.azimuth*Math.PI/180,s=i.elevation*Math.PI/180,r=this.sphericalToCartesian(n,s,i.distance);i.x=r.x,i.y=r.y,i.z=r.z}this.tree=a["default"].createKdTree(this.hrtfDataset,this.distance,["x","y","z"]);var o=this.getHRTF(0,0,1);this.secondaryAudioGraph.setCoefficients(o.iir_coeffs_left,o.iir_coeffs_right),this.secondaryAudioGraph.setDelay(o.itd/1e3),this.mainAudioGraph.setCoefficients(o.iir_coeffs_left,o.iir_coeffs_right),this.mainAudioGraph.setDelay(o.itd/1e3)},get:function(){return this.hrtfDataset}}]),t}();i["default"]=f;var d=function(){function t(e){s(this,t),this.audioContext=e.audioContext,this.bufferSize=1024,this.input=this.audioContext.createGain(),this.gainNode=this.audioContext.createGain(),this.biquadFilterLeft=new h["default"],this.biquadFilterRight=new h["default"],this.fractionalDelayLeft=new c["default"](44100),this.fractionalDelayRight=new c["default"](44100),this.processorNode=this.audioContext.createScriptProcessor(this.bufferSize),this.input.connect(this.processorNode),this.processorNode.connect(this.gainNode),this.processorNodeFunction()}return n(t,[{key:"setCoefficients",value:function(t,e){this.biquadFilterLeft.setCoefficients(t),this.biquadFilterRight.setCoefficients(e)}},{key:"setDelay",value:function(t){var e=.001+t/2,i=.001-t/2;this.fractionalDelayLeft.setDelay(e),this.fractionalDelayRight.setDelay(i)}},{key:"processorNodeFunction",value:function(){var t=this;this.processorNode.onaudioprocess=function(e){var i=e.inputBuffer.getChannelData(0),n=e.outputBuffer.getChannelData(0),s=e.outputBuffer.getChannelData(1),r=new Float32Array(t.fractionalDelayLeft.process(i)),o=new Float32Array(t.fractionalDelayRight.process(i));t.biquadFilterLeft.process(r,n),t.biquadFilterRight.process(o,s)}}},{key:"connect",value:function(t){return this.gainNode.connect(t),this}},{key:"disconnect",value:function(t){return this.gainNode.disconnect(t),this}},{key:"gain",get:function(){return this.gainNode.gain}}]),t}();e.exports=i["default"]},{"babel-runtime/helpers/class-call-check":4,"babel-runtime/helpers/create-class":5,"babel-runtime/helpers/interop-require-default":6,"biquad-filter":10,"fractional-delay":18,kdt:9}],3:[function(t,e,i){e.exports={"default":t("core-js/library/fn/object/define-property"),__esModule:!0}},{"core-js/library/fn/object/define-property":7}],4:[function(t,e,i){"use strict";i["default"]=function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")},i.__esModule=!0},{}],5:[function(t,e,i){"use strict";var n=t("babel-runtime/core-js/object/define-property")["default"];i["default"]=function(){function t(t,e){for(var i=0;i<e.length;i++){var s=e[i];s.enumerable=s.enumerable||!1,s.configurable=!0,"value"in s&&(s.writable=!0),n(t,s.key,s)}}return function(e,i,n){return i&&t(e.prototype,i),n&&t(e,n),e}}(),i.__esModule=!0},{"babel-runtime/core-js/object/define-property":3}],6:[function(t,e,i){"use strict";i["default"]=function(t){return t&&t.__esModule?t:{"default":t}},i.__esModule=!0},{}],7:[function(t,e,i){var n=t("../../modules/$");e.exports=function(t,e,i){return n.setDesc(t,e,i)}},{"../../modules/$":8}],8:[function(t,e,i){var n=Object;e.exports={create:n.create,getProto:n.getPrototypeOf,isEnum:{}.propertyIsEnumerable,getDesc:n.getOwnPropertyDescriptor,setDesc:n.defineProperty,setDescs:n.defineProperties,getKeys:n.keys,getNames:n.getOwnPropertyNames,getSymbols:n.getOwnPropertySymbols,each:[].forEach}},{}],9:[function(t,e,i){function n(t,e,i){this.obj=t,this.left=null,this.right=null,this.parent=i,this.dimension=e}function s(t,e,i){function s(t,e,r){var o,a,u=e%i.length;return 0===t.length?null:1===t.length?new n(t[0],u,r):(t.sort(function(t,e){return t[i[u]]-e[i[u]]}),o=Math.floor(t.length/2),a=new n(t[o],u,r),a.left=s(t.slice(0,o),e+1,a),a.right=s(t.slice(o+1),e+1,a),a)}var o=this;this.root=s(t,0,null),this.insert=function(t){function e(n,s){if(null===n)return s;var r=i[n.dimension];return t[r]<n.obj[r]?e(n.left,n):e(n.right,n)}var s,r,o=e(this.root,null);return null===o?void(this.root=new n(t,0,null)):(s=new n(t,(o.dimension+1)%i.length,o),r=i[o.dimension],void(t[r]<o.obj[r]?o.left=s:o.right=s))},this.remove=function(t){function e(n){if(null===n)return null;if(n.obj===t)return n;var s=i[n.dimension];return t[s]<n.obj[s]?e(n.left,n):e(n.right,n)}function n(t){function e(t,n){var s,r,o,a,u;return null===t?null:(s=i[n],t.dimension===n?null!==t.right?e(t.right,n):t:(r=t.obj[s],o=e(t.left,n),a=e(t.right,n),u=t,null!==o&&o.obj[s]>r&&(u=o),null!==a&&a.obj[s]>u.obj[s]&&(u=a),u))}function s(t,e){var n,r,o,a,u;return null===t?null:(n=i[e],t.dimension===e?null!==t.left?s(t.left,e):t:(r=t.obj[n],o=s(t.left,e),a=s(t.right,e),u=t,null!==o&&o.obj[n]<r&&(u=o),null!==a&&a.obj[n]<u.obj[n]&&(u=a),u))}var r,a,u;return null===t.left&&null===t.right?null===t.parent?void(o.root=null):(u=i[t.parent.dimension],void(t.obj[u]<t.parent.obj[u]?t.parent.left=null:t.parent.right=null)):(r=null!==t.left?e(t.left,t.dimension):s(t.right,t.dimension),a=r.obj,n(r),void(t.obj=a))}var s;s=e(o.root),null!==s&&n(s)},this.nearest=function(t,n,s){function a(s){function r(t,e){l.push([t,e]),l.size()>n&&l.pop()}var o,u,h,c,f=i[s.dimension],d=e(t,s.obj),p={};for(c=0;c<i.length;c+=1)c===s.dimension?p[i[c]]=t[i[c]]:p[i[c]]=s.obj[i[c]];return u=e(p,s.obj),null===s.right&&null===s.left?void((l.size()<n||d<l.peek()[1])&&r(s,d)):(o=null===s.right?s.left:null===s.left?s.right:t[f]<s.obj[f]?s.left:s.right,a(o),(l.size()<n||d<l.peek()[1])&&r(s,d),void((l.size()<n||Math.abs(u)<l.peek()[1])&&(h=o===s.left?s.right:s.left,null!==h&&a(h))))}var u,h,l;if(l=new r(function(t){return-t[1]}),s)for(u=0;n>u;u+=1)l.push([null,s]);for(a(o.root),h=[],u=0;n>u;u+=1)l.content[u][0]&&h.push([l.content[u][0].obj,l.content[u][1]]);return h},this.balanceFactor=function(){function t(e){return null===e?0:Math.max(t(e.left),t(e.right))+1}function e(t){return null===t?0:e(t.left)+e(t.right)+1}return t(o.root)/(Math.log(e(o.root))/Math.log(2))}}function r(t){this.content=[],this.scoreFunction=t}r.prototype={push:function(t){this.content.push(t),this.bubbleUp(this.content.length-1)},pop:function(){var t=this.content[0],e=this.content.pop();return this.content.length>0&&(this.content[0]=e,this.sinkDown(0)),t},peek:function(){return this.content[0]},remove:function(t){for(var e=this.content.length,i=0;e>i;i++)if(this.content[i]==t){var n=this.content.pop();return void(i!=e-1&&(this.content[i]=n,this.scoreFunction(n)<this.scoreFunction(t)?this.bubbleUp(i):this.sinkDown(i)))}throw new Error("Node not found.")},size:function(){return this.content.length},bubbleUp:function(t){for(var e=this.content[t];t>0;){var i=Math.floor((t+1)/2)-1,n=this.content[i];if(!(this.scoreFunction(e)<this.scoreFunction(n)))break;this.content[i]=e,this.content[t]=n,t=i}},sinkDown:function(t){for(var e=this.content.length,i=this.content[t],n=this.scoreFunction(i);;){var s=2*(t+1),r=s-1,o=null;if(e>r){var a=this.content[r],u=this.scoreFunction(a);n>u&&(o=r)}if(e>s){var h=this.content[s],l=this.scoreFunction(h);(null==o?n:u)>l&&(o=s)}if(null==o)break;this.content[t]=this.content[o],this.content[o]=i,t=o}}},e.exports={createKdTree:function(t,e,i){return new s(t,e,i)}}},{}],10:[function(t,e,i){e.exports=t("./dist/biquad-filter")},{"./dist/biquad-filter":11}],11:[function(t,e,i){"use strict";var n=t("babel-runtime/helpers/create-class")["default"],s=t("babel-runtime/helpers/class-call-check")["default"];Object.defineProperty(i,"__esModule",{value:!0});var r=function(){function t(){s(this,t),this.coefficients=[],this.numberOfCascade=1,this.resetMemories()}return n(t,[{key:"setCoefficients",value:function(t){if(t){this.numberOfCascade=this.getNumberOfCascadeFilters(t),this.coefficients=[],this.coefficients.g=t[0];for(var e=0;e<this.numberOfCascade;e++)this.coefficients[e]={b1:t[1+4*e],b2:t[2+4*e],a1:t[3+4*e],a2:t[4+4*e]};return this.resetMemories(),!0}throw new Error("No coefficients are set")}},{key:"getNumberOfCascadeFilters",value:function(t){return(t.length-1)/4}},{key:"resetMemories",value:function(){this.memories=[{xi1:0,xi2:0,yi1:0,yi2:0}];for(var t=1;t<this.numberOfCascade;t++)this.memories[t]={yi1:0,yi2:0}}},{key:"process",value:function(t,e){for(var i,n,s,r,o,a,u,h,l,c,f,d=[],p=0;p<t.length;p++){i=t[p],n=this.coefficients[0].b1,s=this.coefficients[0].b2,r=this.coefficients[0].a1,o=this.coefficients[0].a2,a=this.memories[0].xi1,u=this.memories[0].xi2,h=this.memories[0].yi1,l=this.memories[0].yi2,d[0]=i+n*a+s*u-r*h-o*l;for(var m=1;m<this.numberOfCascade;m++)n=this.coefficients[m].b1,s=this.coefficients[m].b2,r=this.coefficients[m].a1,o=this.coefficients[m].a2,c=this.memories[m-1].yi1,f=this.memories[m-1].yi2,h=this.memories[m].yi1,l=this.memories[m].yi2,d[m]=d[m-1]+n*c+s*f-r*h-o*l;e[p]=d[this.numberOfCascade-1]*this.coefficients.g,this.memories[0].xi2=this.memories[0].xi1,this.memories[0].xi1=i;for(var y=0;y<this.numberOfCascade;y++)this.memories[y].yi2=this.memories[y].yi1,this.memories[y].yi1=d[y]}}}]),t}();i["default"]=r,e.exports=i["default"]},{"babel-runtime/helpers/class-call-check":13,"babel-runtime/helpers/create-class":14}],12:[function(t,e,i){arguments[4][3][0].apply(i,arguments)},{"core-js/library/fn/object/define-property":15,dup:3}],13:[function(t,e,i){arguments[4][4][0].apply(i,arguments)},{dup:4}],14:[function(t,e,i){arguments[4][5][0].apply(i,arguments)},{"babel-runtime/core-js/object/define-property":12,dup:5}],15:[function(t,e,i){arguments[4][7][0].apply(i,arguments)},{"../../modules/$":16,dup:7}],16:[function(t,e,i){arguments[4][8][0].apply(i,arguments)},{dup:8}],17:[function(t,e,i){"use strict";var n=t("babel-runtime/helpers/create-class")["default"],s=t("babel-runtime/helpers/class-call-check")["default"];Object.defineProperty(i,"__esModule",{value:!0});var r=function(){function t(e,i){s(this,t),this.delayTime=0,this.posRead=0,this.posWrite=0,this.fracXi1=0,this.fracYi1=0,this.intDelay=0,this.fracDelay=0,this.a1=void 0,this.sampleRate=e,this.maxDelayTime=i||1,this.bufferSize=this.maxDelayTime*this.sampleRate,this.bufferSize%1!==0&&(this.bufferSize=parseInt(this.bufferSize)+1),this.buffer=new Float32Array(this.bufferSize)}return n(t,[{key:"setDelay",value:function(t){if(!(t<this.maxDelayTime))throw new Error("delayTime > maxDelayTime");this.delayTime=t;var e=t*this.sampleRate;this.intDelay=parseInt(e),this.fracDelay=e-this.intDelay,this.resample(),0!==this.fracDelay&&this.updateThiranCoefficient()}},{key:"getDelay",value:function(){return this.delayTime}},{key:"process",value:function(t){for(var e=new Float32Array(t.length),i=0;i<t.length;i+=1)this.buffer[this.posWrite]=t[i],e[i]=this.buffer[this.posRead],this.updatePointers();return 0===this.fracDelay?e:e=new Float32Array(this.fractionalThiranProcess(e))}},{key:"updatePointers",value:function(){this.posWrite===this.buffer.length-1?this.posWrite=0:this.posWrite=this.posWrite+1,this.posRead===this.buffer.length-1?this.posRead=0:this.posRead=this.posRead+1}},{key:"updateThiranCoefficient",value:function(){this.a1=(1-this.fracDelay)/(1+this.fracDelay)}},{key:"resample",value:function(){if(this.posWrite-this.intDelay<0){var t=this.intDelay-this.posWrite;this.posRead=this.buffer.length-t}else this.posRead=this.posWrite-this.intDelay}},{key:"fractionalThiranProcess",value:function(t){for(var e,i,n=new Float32Array(t.length),s=this.fracXi1,r=this.fracYi1,o=0;o<t.length;o+=1)e=t[o],i=this.a1*e+s-this.a1*r,s=e,r=i,n[o]=i;return this.fracXi1=s,this.fracYi1=r,n}}]),t}();i["default"]=r,e.exports=i["default"]},{"babel-runtime/helpers/class-call-check":20,"babel-runtime/helpers/create-class":21}],18:[function(t,e,i){e.exports=t("./dist/fractional-delay")},{"./dist/fractional-delay":17}],19:[function(t,e,i){arguments[4][3][0].apply(i,arguments)},{"core-js/library/fn/object/define-property":22,dup:3}],20:[function(t,e,i){arguments[4][4][0].apply(i,arguments)},{dup:4}],21:[function(t,e,i){arguments[4][5][0].apply(i,arguments)},{"babel-runtime/core-js/object/define-property":19,dup:5}],22:[function(t,e,i){arguments[4][7][0].apply(i,arguments)},{"../../modules/$":23,dup:7}],23:[function(t,e,i){arguments[4][8][0].apply(i,arguments)},{dup:8}]},{},[1])(1)});